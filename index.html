<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Romaneio ‚Ä¢ Login</title>
  <meta name="theme-color" content="#0d1117" />
  <link rel="icon" href="icon-192.png" />
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --muted:#98a2b3; --text:#e6edf3;
      --primary:#2563eb; --primary-2:#1d4ed8; --border:#1f2a44;
      --ok:#16a34a; --err:#dc2626;
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 600px at 20% -10%,rgba(37,99,235,.18),transparent 60%),var(--bg);color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;min-height:100dvh;display:grid;place-items:center}
    .card{width:min(520px,92vw);background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:22px 20px}
    h1{margin:0 0 10px 0;font-size:18px}
    label{font-size:12px;color:var(--muted);display:block;margin:.25rem 0 .35rem}
    input{width:100%;background:#0b1220;border:1px solid var(--border);color:var(--text);border-radius:10px;padding:12px}
    .btn{width:100%;padding:.8rem 1rem;background:var(--primary);border:0;border-radius:10px;color:#fff;font-weight:800;cursor:pointer;margin-top:12px}
    .btn:hover{background:var(--primary-2)}
    .muted{color:var(--muted);font-size:12px;margin-top:10px}
    .brand{display:flex;gap:8px;align-items:center;margin-bottom:10px;font-weight:800}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);backdrop-filter:saturate(120%) blur(2px);display:none;align-items:center;justify-content:center;z-index:50}
    .bar{width:220px;height:8px;background:#0b1220;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .bar>span{display:block;height:100%;width:0;background:linear-gradient(90deg,#2563eb,#60a5fa);animation:load 1.2s infinite}
    @keyframes load{0%{width:0}50%{width:90%}100%{width:0;transform:translateX(100%)}}
    .toast{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);
      background:#0b1220;border:1px solid var(--border);padding:10px 14px;border-radius:10px;display:none;z-index:60}
    .toast.ok{border-color:rgba(22,163,74,.5)}
    .toast.err{border-color:rgba(220,38,38,.5)}
  </style>
</head>
<body>
  <div class="card">
    <div class="brand">üöö Romaneio</div>
    <h1>Acesso</h1>
    <div class="row">
      <label>Usu√°rio</label>
      <input id="usuario" placeholder="admin" autocomplete="username">
    </div>
    <div class="row" style="margin-top:8px">
      <label>Senha</label>
      <input id="senha" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
    </div>
    <button class="btn" onclick="doLogin()">Entrar</button>
    <div class="muted">Admin cria/gerencia usu√°rios via planilha. Precisa de acesso? Fale com o respons√°vel.</div>
    <div class="muted" style="text-align:center;margin-top:10px">v1 ‚Ä¢ PWA (instal√°vel)</div>
  </div>

  <div id="overlay" class="overlay"><div class="bar"><span></span></div></div>
  <div id="toast" class="toast"></div>

<script>
/* ====== CONFIG ====== */
const API_BASE = "https://script.google.com/macros/s/AKfycbzahPVwksRN4y6WnYZ6sXfCWftB_YDiL2nfyTw0QPMelz_A_3GKmrtMV-4QysIhTu8R/exec";

/* ====== helpers ====== */
const $ = (s)=>document.querySelector(s);
function setLoading(v){ $("#overlay").style.display = v ? "flex" : "none"; }
function toast(msg, kind="ok"){ const t=$("#toast"); t.textContent=msg; t.className="toast "+kind; t.style.display="block"; setTimeout(()=>t.style.display="none", 3000); }
function saveSession(s){ localStorage.setItem("session", JSON.stringify(s)); }

/* normaliza o path pra SEMPRE come√ßar com ‚Äú/‚Äù */
function urlWithPath(path){
  const p = path.startsWith("/") ? path : "/"+path;
  return API_BASE + "?path=" + encodeURIComponent(p);
}

async function doLogin(){
  const usuario = $("#usuario").value.trim();
  const senha   = $("#senha").value.trim();
  if(!usuario || !senha){ toast("Informe usu√°rio e senha.", "err"); return; }

  try{
    setLoading(true);
    const res = await fetch(urlWithPath("/login"), {
      method:"POST",
      headers:{ "Content-Type":"text/plain;charset=utf-8" },
      body: JSON.stringify({ usuario, senha }),
      cache:"no-store"
    });
    setLoading(false);

    if(!res.ok){ toast("Erro HTTP "+res.status, "err"); return; }
    const r = await res.json();

    if(r.error){ toast(r.error, "err"); return; }
    if(r.session?.token){
      saveSession(r.session);
      toast("Login conclu√≠do.", "ok");
      location.replace("app.html");
    }else{
      toast("Resposta inv√°lida da API.", "err");
    }
  }catch(err){
    setLoading(false);
    toast("Falha de rede: "+(err?.message||err), "err");
  }
}

/* UX: enter pra logar */
document.addEventListener("keydown", (e)=>{
  if(e.key==="Enter") doLogin();
});
</script>
</body>
</html>
