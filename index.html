<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Romaneio ‚Ä¢ Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0d1117" />
  <style>
    :root {
      --bg:#0b0f19;--panel:#0f172a;--muted:#8a94a6;--text:#e6edf3;
      --primary:#2563eb;--primary-hover:#1d4ed8;--border:#1f2a44
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Ubuntu,sans-serif}
    main{min-height:100vh;display:grid;place-items:center;padding:20px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:22px;width:100%;max-width:400px;box-shadow:0 10px 20px rgba(0,0,0,.4)}
    h2{text-align:center;margin:0 0 14px}
    label{display:block;margin-top:12px;font-size:.9rem;color:var(--muted)}
    input{width:100%;padding:10px;margin-top:4px;border-radius:8px;border:1px solid var(--border);background:#0b0f19;color:var(--text)}
    button{width:100%;margin-top:16px;padding:12px;background:var(--primary);color:#fff;border:none;border-radius:8px;font-size:1rem;cursor:pointer}
    button:hover{background:var(--primary-hover)}
    .msg{margin-top:14px;font-size:.9rem;text-align:center}
    .error{color:#f87171}
    .success{color:#4ade80}
    footer{text-align:center;margin-top:20px;font-size:.8rem;color:var(--muted)}
  </style>
</head>
<body>
  <main>
    <div class="card">
      <h2>Acesso</h2>
      <label>Usu√°rio
        <input id="usuario" type="text" placeholder="Usu√°rio" />
      </label>
      <label>Senha
        <input id="senha" type="password" placeholder="Senha" />
      </label>
      <button onclick="login()">Entrar</button>
      <div class="msg" id="msg"></div>
    </div>
    <footer>
      v1 ‚Ä¢ PWA (instal√°vel)
    </footer>
  </main>

  <script>
    // üöÄ URL base da API (sua implanta√ß√£o Google Apps Script)
    const API_BASE = "https://script.google.com/macros/s/AKfycbyGZu5c4vTiXjQx5Ud45m0Ij3Dotejl_ziYTdFmjtWXU4cPRz1i2qWLPkVF4RzhuIMr/exec";

    // üîß Helper seguro para chamadas API
    async function apiFetch(path, options = {}) {
      try {
        const res = await fetch(API_BASE + path, {
          method: options.method || "POST",
          headers: { "Content-Type": "application/json" },
          body: options.body ? JSON.stringify(options.body) : null
        });
        if (!res.ok) throw new Error("Erro HTTP " + res.status);
        return await res.json();
      } catch (err) {
        console.error("Erro ao chamar API:", err);
        document.getElementById("msg").innerHTML = `<span class="error">‚ùå Erro: ${err.message}</span>`;
        throw err;
      }
    }

    // üîë Fun√ß√£o de login
    async function login() {
      const usuario = document.getElementById("usuario").value.trim();
      const senha = document.getElementById("senha").value.trim();
      const msg = document.getElementById("msg");

      if (!usuario || !senha) {
        msg.innerHTML = `<span class="error">‚ùå Preencha usu√°rio e senha</span>`;
        return;
      }

      msg.innerHTML = "‚è≥ Verificando...";

      try {
        const data = await apiFetch("/login", { body: { usuario, senha } });

        if (data.ok) {
          msg.innerHTML = `<span class="success">‚úÖ Login OK! Redirecionando...</span>`;
          // salva a sess√£o localmente
          localStorage.setItem("session", JSON.stringify(data.session));
          setTimeout(() => { window.location.href = "app.html"; }, 1000);
        } else {
          msg.innerHTML = `<span class="error">‚ùå ${data.error || "Falha no login"}</span>`;
        }
      } catch (err) {
        console.log("Falha de comunica√ß√£o:", err);
      }
    }
  </script>
</body>
</html>
