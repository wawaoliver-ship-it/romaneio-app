<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Romaneio App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0d1117" />
  <style>
    :root{
      --bg:#0b0f19;--panel:#0f172a;--muted:#8a94a6;--text:#e6edf3;
      --primary:#2563eb;--primary-hover:#1d4ed8;--border:#1f2a44;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif}
    header{position:sticky;top:0;background:#0d1117;border-bottom:1px solid var(--border);padding:14px 18px;display:flex;gap:10px;align-items:center}
    header b{color:#9abaff}
    main{min-height:calc(100vh - 56px);display:grid;place-items:center;padding:24px}
    .card{width:min(420px,92vw);background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h2{margin:0 0 14px 0;text-align:center;letter-spacing:.4px}
    .field{margin:.7rem 0}
    .field label{display:block;margin:0 0 .35rem .1rem;color:var(--muted);font-size:.92rem}
    .field input{width:100%;padding:.75rem .85rem;border-radius:10px;border:1px solid #243146;background:#0b0f1a;color:var(--text)}
    button{width:100%;margin-top:12px;padding:.85rem;border:1px solid var(--primary);background:var(--primary);color:#fff;border-radius:10px;font-weight:700;cursor:pointer}
    button:hover{background:var(--primary-hover)}
    small{display:block;margin-top:.6rem;color:var(--muted)}
    pre#output{margin-top:10px;background:#0b0f1a;border:1px solid var(--border);border-radius:10px;padding:10px;color:#9ee;white-space:pre-wrap;word-break:break-word;min-height:40px}
  </style>
</head>
<body>
  <header>üöö <b>Romaneio</b></header>

  <main>
    <section class="card">
      <h2>Acesso</h2>

      <div class="field">
        <label for="usuario">Usu√°rio</label>
        <input id="usuario" placeholder="ex.: admin" autocomplete="username"/>
      </div>

      <div class="field">
        <label for="senha">Senha</label>
        <input id="senha" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"/>
      </div>

      <button id="btnDoLogin">Entrar</button>
      <small>Admin cria/gerencia usu√°rios via planilha. Precisa de acesso? Fale com o respons√°vel.</small>

      <pre id="output"></pre>
    </section>
  </main>

  <script>
    // üîó SUA API (implanta√ß√£o v3)
    const API_BASE = "https://script.google.com/macros/s/AKfycbxM4FUC7kD5PuP_DhoX1Yph6F-2n0-o88QSsAYUmsfNWHItmo3_D8O7PJ9OZwwkB0hW/exec";

    async function ping(out){
      out.textContent = "üîé Testando conex√£o...";
      const r = await fetch(API_BASE + "?path=%2Fping"); // GET simples
      const t = await r.text();
      out.textContent = "‚úÖ Ping OK\n" + t;
    }

    document.getElementById("btnDoLogin").addEventListener("click", async (e) => {
      e.preventDefault();
      const out = document.getElementById("output");
      const usuario = document.getElementById("usuario").value.trim();
      const senha = document.getElementById("senha").value;

      try {
        // 1) Diagn√≥stico r√°pido
        await ping(out);

        // 2) Login sem preflight (usa text/plain)
        out.textContent += "\n\n‚û°Ô∏è Enviando login...";
        const res = await fetch(API_BASE + "?path=/login", {
          method: "POST",
          headers: { "Content-Type": "text/plain" }, // evita CORS preflight
          body: JSON.stringify({ usuario, senha })
        });

        const txt = await res.text();
        let data; try { data = JSON.parse(txt); } catch { throw new Error("Resposta n√£o-JSON: " + txt); }
        if (!res.ok || data.error) throw new Error(data.error || ("HTTP " + res.status));

        out.textContent += "\n\n‚úÖ Login OK\n" + JSON.stringify(data, null, 2);
        // TODO: redirecionar para a tela principal ap√≥s integrar
        // window.location.href = "app.html";
      } catch (err) {
        out.textContent += "\n\n‚ùå Erro: " + err.message +
          "\nDica: se persistir, abra em janela an√¥nima ou limpe o cache do PWA.";
      }
    });
  </script>
</body>
</html>
