<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Romaneio ‚Ä¢ Login</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--fg:#e5e7eb;--muted:#94a3b8;--brand:#2563eb;--danger:#ef4444}
    body{margin:0;background:#0f172a;color:var(--fg);font:500 16px/1.4 system-ui,Segoe UI,Arial}
    .center{min-height:100dvh;display:grid;place-items:center}
    .card{width:min(420px,92vw);background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:28px;box-shadow:0 8px 30px rgba(0,0,0,.25)}
    h1{margin:0 0 8px;font-weight:700}
    .muted{color:var(--muted);font-weight:400;margin-bottom:22px}
    label{display:block;margin:14px 0 6px;color:var(--muted);font-size:.95rem}
    input{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #1f2937;background:#0a1020;color:var(--fg);outline:none}
    input:focus{border-color:#334155}
    .btn{display:inline-grid;place-items:center;height:44px;padding:0 16px;border-radius:10px;border:0;cursor:pointer}
    .primary{background:var(--brand);color:white;width:100%;margin-top:16px}
    .link{color:#93c5fd;text-decoration:none}
    .err{margin-top:12px;background:rgba(239,68,68,.12);border:1px solid rgba(239,68,68,.35);color:#fecaca;padding:10px 12px;border-radius:10px;display:none}
    .row{display:flex;gap:10px;justify-content:flex-end;margin-top:8px}
  </style>
</head>
<body>
  <div class="center">
    <div class="card">
      <h1>üöö Romaneio</h1>
      <div class="muted">Acesse com seu usu√°rio e senha.</div>

      <label>Usu√°rio</label>
      <input id="usu" placeholder="Ex.: admin" autocomplete="username" value="admin"/>

      <label>Senha</label>
      <input id="pwd" type="password" placeholder="Ex.: 123456" autocomplete="current-password"/>

      <button class="btn primary" id="btnLogin">Entrar</button>
      <div class="row"><a class="link" href="#" id="btnTest">Testar conex√£o</a></div>
      <div class="err" id="msg"></div>
    </div>
  </div>

<script>
/** CONFIG ‚Äì cole sua URL googleusercontent aqui */
const API_BASE = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLgNJA1vrNW6E5KMUUpA_eDS1PyLc1ymDTn6TV-NoUUuKqrUhXYySJ-uk9wpWxlPFUEo5JZwfyyEEoeqZetFzVzlnPMvajAz_4AMr6DxnWXS0NwHJeYL9kqXBQLiYX-4Ew8kc4sRjF7kzl3OfVVey1bKUUpHGBpg1oTQWk5ULOh_wth0fq_ljZYJl_clpNupHt8FpBBYkPAt64XWqO_Qcu9GZcdfNpWeSI4r8IyI2Yh8DvYGNVhYK9fYhUMlMRkeFSqmJGB65C0oDdAD2bT5fGAkDr4jAA&lib=MgCquoYzRceSzn8l97_yAGg5THVlN2byw";

/** util */
function setMsg(t){ const el = document.getElementById('msg'); if(t){el.style.display='block'; el.textContent=t;} else el.style.display='none'; }

/** chamada API padr√£o */
async function api(path, data={}){
  const r = await fetch(API_BASE+"?path="+encodeURIComponent(path),{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(data)
  });
  if(!r.ok) throw new Error("HTTP "+r.status);
  return r.json();
}

document.getElementById('btnTest').addEventListener('click', async (e)=>{
  e.preventDefault();
  setMsg('');
  try{
    const j = await api("/ping",{});
    alert("OK: "+JSON.stringify(j));
  }catch(err){
    setMsg("Erro de rede: "+err.message);
  }
});

document.getElementById('btnLogin').addEventListener('click', async ()=>{
  setMsg('');
  const usuario = document.getElementById('usu').value.trim();
  const senha   = document.getElementById('pwd').value;
  if(!usuario || !senha){ setMsg("Preencha usu√°rio e senha"); return; }
  try{
    const j = await api("/login",{usuario, senha});
    if(j.error){ setMsg(j.error); return; }
    const ses = j.session || {};
    // guarda sess√£o e API_BASE para o app
    localStorage.setItem("rom_api", API_BASE);
    localStorage.setItem("rom_token", ses.token);
    localStorage.setItem("rom_user", JSON.stringify(ses));
    // cache-busting
    location.href = "app.html?v="+Date.now()+"#rom";
  }catch(err){
    setMsg("Erro de rede: "+err.message);
  }
});
</script>
</body>
</html>
