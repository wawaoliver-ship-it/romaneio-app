<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Romaneio • Painel</title>
  <meta name="theme-color" content="#0d1117" />
  <style>
    body {margin:0;font-family:system-ui, sans-serif;background:#0d1117;color:#e6edf3;}
    .topbar {
      background:#161b22;
      padding:10px 14px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid #30363d;
    }
    .btn {background:#2563eb;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;}
    .btn:hover {background:#1d4ed8;}
    main {padding:20px;}
    .card {
      background:#161b22;
      padding:16px;
      border-radius:8px;
      margin-bottom:16px;
      border:1px solid #30363d;
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div><b>Romaneio</b></div>
    <div>
      <span id="usuarioInfo"></span>
      <button class="btn" onclick="logout()">Sair</button>
    </div>
  </div>

  <main>
    <div class="card">
      <h3>Novo Romaneio</h3>
      <p>Em breve: formulário completo para registrar romaneios com foto, volumes e impressão A4.</p>
    </div>
    <div class="card">
      <h3>Meus Romaneios</h3>
      <p>Filtro por cidade/romaneio e impressão. Integração chega no próximo passo.</p>
    </div>
    <div class="card">
      <h3>Clientes</h3>
      <p>Consulta/cadastro automático por telefone na próxima etapa.</p>
    </div>
    <div id="sessao" class="card"></div>
  </main>

<script>
const API_BASE = "https://script.google.com/macros/s/AKfycbxQjxpt1hA1KnQ2p9-LOWTCWtUaf--Zr1-02juFuHe5lXR1Ait7t_QsLOJf0yCYteQ/exec";

async function checkSession(){
  const s = localStorage.getItem("session");
  if(!s){ window.location.href="index.html"; return; }
  const session = JSON.parse(s);
  document.getElementById("usuarioInfo").innerText = 
    session.name+" • "+session.role;

  try {
    const r = await fetch(API_BASE+"?op=session", {
      method:"POST",
      body: JSON.stringify({token: session.token})
    });
    const data = await r.json();
    if(!data.ok){
      logout();
    } else {
      document.getElementById("sessao").innerText = 
        "Sessão ativa até: "+session.expira_em;
    }
  } catch(e){
    document.getElementById("sessao").innerText = "Falha ao carregar sessão";
  }
}

function logout(){
  localStorage.removeItem("session");
  window.location.href="index.html";
}

checkSession();
</script>
</body>
</html>
